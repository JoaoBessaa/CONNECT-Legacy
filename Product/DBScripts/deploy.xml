<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="deploy" name="NHINC.database.deploy">

  <import file="properties.xml" />

  <target name="deploy">
    <echo>
      Please choose a target:
      database.drop
      database.create
      database.recreate
      database.populateWithTestData
      database.recreateTestDatabase
    </echo>
  </target>

  <target name="database.populate.test.data">
    <execsql file="${basedir}/nhincdb/populateTestData.sql"/>
  </target>

  <target name="database.alter">

  </target>

  <target name="database.drop">
    <execsql file="${basedir}/nhincdb/dropall.sql"/>
  </target>

  <target name="database.create">
    <execsql file="${basedir}/nhincdb/nhincdb.sql"/>
  </target>

  <target name="database.recreate">
    <runtarget target="database.drop"/>
    <runtarget target="database.create"/>
  </target>

  <target name="database.recreateTestDatabase">
    <runtarget target="database.recreate"/>
    <runtarget target="database.populate.test.data"/>
  </target>

  <macrodef name="execsql">
    <attribute name="file" />
    <sequential>
      <sql classpath="${database.jdbc.driver.classpath}"
                driver="${database.jdbc.driver}"
                url="${database.url}"
                userid="${database.admin.username}"
                password="${database.admin.password}"
                autocommit="true"
                escapeprocessing="false">
        <transaction src="@{file}"/>
      </sql>
    </sequential>
  </macrodef>
</project>